groups:
- name: CPU
  rules:
  - alert: CPUHighUsage
    expr: (1 - avg(rate(node_cpu_seconds_total{mode="idle",}[1m]))) * 100 > 50
    for: 1m
    labels:
      severity: medium
    annotations:
      summary: "CPU usage on {{ $labels.instance }} is over 50%"
      description: "An instance {{ $labels.instance }} CPU consumption is too high - ({{ $value }})"
- name: http
  rules:
  - alert: TooMany5xxResponses
    expr: sum by (instance) (http_requests_total{code =~ "5.+"}) /  sum by (instance) (http_requests_total{}) >= 0.3
    for: 1m
    annotations:
      summary: "Too many 5xx responses on instance {{ $labels.instance }}"
      description: "Too many 5xx responses on instance {{ $labels.instance }}"